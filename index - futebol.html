<!doctype html>
<html lang="pt-BR">
<head>
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CornerAnalyzer ‚Äî An√°lise de Escanteios</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body { background: #f8fafc; }
    .card { background: white; border-radius: .5rem; padding: 1rem; box-shadow: 0 6px 16px rgba(15,23,42,0.06); }
    .list-scroll { max-height: 52vh; overflow:auto }
  </style>
</head>
<body class="min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-3xl font-bold">CornerAnalyzer ‚Äî An√°lise de Escanteios</h1>
      <div class="flex gap-2 items-center">
        <input id="csvFile" type="file" accept=".csv" class="hidden" />
        <label for="csvFile" class="px-3 py-2 bg-white rounded shadow border cursor-pointer">Upload CSV</label>
        <button id="exportCsv" class="px-3 py-2 bg-white rounded shadow border">Exportar CSV</button>
      </div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <section class="lg:col-span-2">
        <div class="card mb-4">
          <div class="flex gap-3 items-center mb-4">
            <input id="search" placeholder="Procurar time..." class="flex-1 border p-2 rounded" />
            <select id="competition" class="border p-2 rounded">
              <option>All</option>
            </select>
            <div class="flex items-center gap-2">
              <label>Min escanteios</label>
              <input id="minCorners" type="number" value="0" class="w-20 border p-2 rounded" />
            </div>
          </div>

          <div id="matchList" class="space-y-3 list-scroll"></div>
        </div>

        <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div class="card">
            <div class="text-sm text-gray-500">Partidas</div>
            <div id="totalMatches" class="text-2xl font-bold">0</div>
          </div>
          <div class="card">
            <div class="text-sm text-gray-500">M√©dia de escanteios / partida</div>
            <div id="avgCorners" class="text-2xl font-bold">0</div>
          </div>
          <div class="card">
            <div class="text-sm text-gray-500">Partidas abaixo de 4</div>
            <div id="below4" class="text-2xl font-bold">0</div>
          </div>
        </div>
      </section>

      <aside class="space-y-4">
        <div class="card h-72">
          <h3 class="font-semibold mb-2">M√©dia di√°ria de escanteios</h3>
          <canvas id="lineChart" height="200"></canvas>
        </div>

        <div class="card">
          <h3 class="font-semibold mb-2">Distribui√ß√£o de partidas</h3>
          <canvas id="barChart" height="180"></canvas>
          <div class="text-xs text-gray-500 mt-2">Passe o mouse sobre as barras para ver o total.</div>
        </div>

        <div class="card">
          <h3 class="font-semibold mb-2">Detalhes da partida</h3>
          <div id="selectedDetail" class="text-sm text-gray-500">Selecione uma partida √† esquerda para ver detalhes.</div>
        </div>
      </aside>
    </main>

    <footer class="mt-6 text-sm text-gray-600 text-center">Desenvolvido com ‚ù§Ô∏è ‚Äî Upload/Export CSV, filtros, estat√≠sticas r√°pidas e gr√°ficos.</footer>
  </div>

<script>
// Sample data
let matches = [
  { id:1, date:'2025-11-29', competition:'Brasileir√£o A', home:'Flamengo', away:'Palmeiras', corners_home:4, corners_away:3, minutes_with_corner:[5,12,36,44,58,72,81] },
  { id:2, date:'2025-11-28', competition:'Brasileir√£o A', home:'Corinthians', away:'Atl√©tico-MG', corners_home:1, corners_away:2, minutes_with_corner:[22,67,90] },
  { id:3, date:'2025-11-27', competition:'Premier League', home:'Manchester Utd', away:'Chelsea', corners_home:6, corners_away:4, minutes_with_corner:[3,9,18,23,29,46,48,66,74,88] }
];
matches = matches.map(m => ({ ...m, total_corners: (m.corners_home||0)+(m.corners_away||0) }));

const refs = {
  matchList: document.getElementById('matchList'),
  search: document.getElementById('search'),
  competition: document.getElementById('competition'),
  minCorners: document.getElementById('minCorners'),
  totalMatches: document.getElementById('totalMatches'),
  avgCorners: document.getElementById('avgCorners'),
  below4: document.getElementById('below4'),
  selectedDetail: document.getElementById('selectedDetail'),
  csvFile: document.getElementById('csvFile'),
  exportCsv: document.getElementById('exportCsv')
};

function formatDate(d){ return new Date(d).toLocaleDateString(); }

function aggregateByDate(data){
  const map = {};
  data.forEach(m => { const day = m.date; if(!map[day]) map[day]={date:day,total:0,count:0}; map[day].total+=m.total_corners; map[day].count+=1; });
  return Object.values(map).map(x=>({ date:x.date, avg: x.total/x.count }));
}

function probabilityLessThanFour(match){
  const compMatches = matches.filter(m => refs.competition.value === 'All' || m.competition === match.competition);
  const avg = compMatches.reduce((s,m)=>s+m.total_corners,0)/Math.max(1,compMatches.length);
  const p = 1/(1+Math.exp((avg-4)/1.2));
  return Math.round(p*100);
}

// Charts
let lineChart, barChart;
function createCharts(){
  const lineCtx = document.getElementById('lineChart').getContext('2d');
  const barCtx = document.getElementById('barChart').getContext('2d');
  const lineData = aggregateByDate(matches).sort((a,b)=>new Date(a.date)-new Date(b.date));
  const labels = lineData.map(d=>d.date);
  const data = lineData.map(d=>d.avg);

  if(lineChart) lineChart.destroy();
  lineChart = new Chart(lineCtx, { type:'line', data:{ labels, datasets:[{ label:'M√©dia de escanteios', data, tension:0.4 }] }, options:{ responsive:true, maintainAspectRatio:false } });

  if(barChart) barChart.destroy();
  barChart = new Chart(barCtx, { type:'bar', data:{ labels: matches.map(m=>m.home+' x '+m.away), datasets:[{ label:'Total escanteios', data: matches.map(m=>m.total_corners) }] }, options:{ indexAxis:'x', responsive:true, maintainAspectRatio:false } });
}

function renderList(){
  const q = refs.search.value.trim().toLowerCase();
  const comp = refs.competition.value;
  const minC = Number(refs.minCorners.value)||0;
  const filtered = matches.filter(m => (comp==='All'||m.competition===comp) && m.total_corners>=minC && (!q || m.home.toLowerCase().includes(q) || m.away.toLowerCase().includes(q)) );

  refs.matchList.innerHTML = '';
  if(filtered.length===0) refs.matchList.innerHTML = '<div class="text-sm text-gray-500">Nenhuma partida encontrada.</div>';
  filtered.forEach(m => {
    const el = document.createElement('article');
    el.className = 'p-3 rounded border cursor-pointer hover:bg-gray-50 flex justify-between items-center';
    el.innerHTML = `<div><div class="font-semibold">${m.home} <span class="text-gray-500">x</span> ${m.away}</div><div class="text-sm text-gray-600">${m.competition} ‚Ä¢ ${formatDate(m.date)}</div></div><div class="text-right"><div class="font-mono text-lg">${m.total_corners}</div><div class="text-sm text-gray-600">${m.corners_home} - ${m.corners_away}</div></div>`;
    el.onclick = ()=>selectMatch(m);
    refs.matchList.appendChild(el);
  });

  refs.totalMatches.textContent = matches.length;
  refs.avgCorners.textContent = (Math.round((matches.reduce((s,m)=>s+m.total_corners,0)/Math.max(1,matches.length))*10)/10).toString();
  refs.below4.textContent = matches.filter(m=>m.total_corners<4).length;
}

function selectMatch(m){
  refs.selectedDetail.innerHTML = `<div class="font-semibold">${m.home} x ${m.away}</div><div class="text-sm text-gray-600">${m.competition} ‚Ä¢ ${formatDate(m.date)}</div><div class="mt-2">Total de escanteios: <span class="font-bold">${m.total_corners}</span></div><div class="mt-1 text-sm">Casa: ${m.corners_home} ‚Ä¢ Fora: ${m.corners_away}</div><div class="mt-3">Probabilidade (estimada) de ficar abaixo de 4: <span class="font-bold">${probabilityLessThanFour(m)}%</span></div>`;
}

function populateCompetitions(){
  const comps = ['All', ...Array.from(new Set(matches.map(m=>m.competition)))];
  refs.competition.innerHTML = comps.map(c=>`<option>${c}</option>`).join('');
}

// CSV handling (simple)
refs.csvFile.addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    try{
      const text = ev.target.result;
      const lines = text.split(/?
/).filter(Boolean);
      const headers = lines[0].split(',').map(h=>h.trim());
      const data = lines.slice(1).map(ln=>{ const cols = ln.split(',').map(c=>c.trim()); const obj={}; headers.forEach((h,i)=>obj[h]=cols[i]); return { id:Number(obj.id), date:obj.date, competition:obj.competition, home:obj.home, away:obj.away, corners_home:Number(obj.corners_home||0), corners_away:Number(obj.corners_away||0) } });
      const normalized = data.map(d=>({ ...d, total_corners:(d.corners_home||0)+(d.corners_away||0) }));
      matches = [...normalized, ...matches];
      populateCompetitions(); renderAll();
    }catch(err){ alert('Erro ao ler CSV. Formato inv√°lido.'); }
  };
  reader.readAsText(file);
});

refs.exportCsv.addEventListener('click', ()=>{
  const header = ['id','date','competition','home','away','corners_home','corners_away'].join(',');
  const rows = matches.map(m=>[m.id,m.date,m.competition,m.home,m.away,m.corners_home,m.corners_away].join(','));
  const csv = header + '
' + rows.join('
');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'corner-data.csv'; a.click(); URL.revokeObjectURL(url);
});

refs.search.addEventListener('input', renderList);
refs.competition.addEventListener('change', ()=>{ renderList(); createCharts(); });
refs.minCorners.addEventListener('input', renderList);

function renderAll(){ renderList(); createCharts(); }

populateCompetitions(); renderAll();
</script>
  <!-- Service Worker Registration -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
  <!-- Demo Account System -->
  <script>
    // Demo credentials
    const DEMO_USER = "demo";
    const DEMO_PASS = "1234";

    function showLogin() {
      document.getElementById("loginModal").classList.remove("hidden");
    }

    function doLogin() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;

      if (u === DEMO_USER && p === DEMO_PASS) {
        localStorage.setItem("logged", "true");
        document.getElementById("loginModal").classList.add("hidden");
        document.getElementById("mainContent").classList.remove("hidden");
      } else {
        alert("Usu√°rio ou senha incorretos! Use demo / 1234");
      }
    }

    function checkLogin() {
      const logged = localStorage.getItem("logged") === "true";

      if (!logged) {
        document.getElementById("mainContent").classList.add("hidden");
        showLogin();
      }
    }

    checkLogin();
  </script>

  <!-- Login Modal -->
  <div id="loginModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-xl">
      <h2 class="text-xl font-bold mb-4 text-center">Acesso Demo</h2>

      <input id="username" type="text" placeholder="Usu√°rio: demo" class="w-full p-2 border rounded mb-3">
      <input id="password" type="password" placeholder="Senha: 1234" class="w-full p-2 border rounded mb-4">

      <button onclick="doLogin()" class="w-full bg-blue-600 text-white p-2 rounded-xl font-semibold">Entrar</button>
    </div>
  </div>
</body>
<!-- README (Instru√ß√µes de Deploy) -->
<!--
# README ‚Äì Corner Analyzer

## üöÄ Deploy no Vercel
1. Crie uma conta em vercel.com
2. Clique em **New Project**
3. Envie este arquivo HTML
4. Deploy autom√°tico

## üöÄ Deploy no Netlify
1. Acesse netlify.com
2. Clique em **Add new site ‚Üí Deploy manually**
3. Envie o arquivo index.html

## üì° Integra√ß√£o com API
O c√≥digo agora possui a fun√ß√£o `fetchFromAPI()` que tenta buscar dados de escanteios de uma API externa.

Edite o endpoint dentro do JS:
```js
const API_ENDPOINT = "https://suaapi.com/escanteios";
```
A API deve retornar JSON no formato:
```json
[
  {"partida":"Time A x Time B", "competicao":"Liga", "escanteios":7, "chanceUnder4":0.22}
]
```

## üì± PWA ‚Äì Aplicativo Instal√°vel
Agora o site inclui:
- `manifest.json`
- registro autom√°tico do service worker

Basta subir os arquivos que ser√£o gerados automaticamente.
-->

</html>

